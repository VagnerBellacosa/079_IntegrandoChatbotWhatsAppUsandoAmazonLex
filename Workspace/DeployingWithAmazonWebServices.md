- 

![img](https://scontent.fcpq6-1.fna.fbcdn.net/v/t39.8562-6/59399685_595945094257428_807173360218800128_n.png?_nc_cat=108&ccb=1-5&_nc_sid=6825c5&_nc_eui2=AeET_gpeKh2r0035_ctLlp4szP3XULvbe8rM_ddQu9t7ygTtKi6kRrN8zZyUiSyXZEpzNVqaUgefBM88OkU80fvT&_nc_ohc=P-mSlkFSrNIAX-JPGq6&_nc_oc=AQn1ZocYTILhQHjMZN8xqebop5pzl0-fZhu0KIJ-2tREMdQXtS0SBogvxcy5gHMg__gkUe_jbwRhy8KVqx6_lEil&_nc_ht=scontent.fcpq6-1.fna&oh=3b7d76d88600ea4de36479749fab0a62&oe=619AACBA)Deploying with Amazon Web ServicesThis document shows you how to use Amazon Web Services (AWS) to deploy the WhatsApp Business API. The process can be divided into two main steps:[WhatsApp Business API client **Deployment**](https://developers.facebook.com/docs/whatsapp/aws/#deployment)[WhatsApp Business API client **Configuration**](https://developers.facebook.com/docs/whatsapp/aws/#setup)Once you have completed the set up, you can choose to [upgrade the client](https://developers.facebook.com/docs/whatsapp/aws/#upgrade). If you ever need to restart both the Webapp and CoreApp, follow [these steps](https://developers.facebook.com/docs/whatsapp/aws/#restart).Before You StartYou will need:To set up an [AWS Account ID](https://developers.facebook.com/docs/whatsapp/aws/#id)To create an [AWS Key Pair](https://developers.facebook.com/docs/whatsapp/aws/#pair)To subscribe to a [CentOS 7 Image](https://developers.facebook.com/docs/whatsapp/aws/#centos)To deploy in a [supported region](https://developers.facebook.com/docs/whatsapp/aws/#regions)Set up an AWS Account IDYou need to set up a valid AWS account and be familiar with working on AWS. WhatsApp provides CloudFormation templates for deploying the WhatsApp Business API client easily. Refer to the [AWS Getting Started Resource Center](https://l.facebook.com/l.php?u=https%3A%2F%2Faws.amazon.com%2Fgetting-started%2F%3Ffbclid%3DIwAR2A4_jFnvOpWybyZrc7vyUsVfSPDrh1HSghc5f1knLOHzLmfFmflCJ41xg&h=AT1UOKm6P1dfFWQBC7mmuN0RAB1O9_7b_7QyLtFQm-ErBJxZ44T5aRnJiJOGAlggAUjDwRyvb92DifH4unlsKThlwBjxdPophnPmnBoC9YP9lEUjVM3Wmq3dQma82UFJL9kq5JhoDTREJQN8j6DYbjLjnorqmfjCopM) for more information.Create an AWS Key PairYou need to create a new key pair to access the EC2 instance created by the WhatsApp Business API template. You can also use a previously created key pair. Refer to the [Amazon EC2 Key Pairs documentation](https://l.facebook.com/l.php?u=http%3A%2F%2Fdocs.aws.amazon.com%2FAWSEC2%2Flatest%2FUserGuide%2Fec2-key-pairs.html%3Ffbclid%3DIwAR39PkNrKR8n5K-td-ocQZ1q2_UtOfjZXAhqgTBB3mpBVANXlqHDt1uZSMI&h=AT1k0-4AA_yySeBexKsWGffJDO4n5oQ6-ta4bS820XatNyDjo0PVC49xpQFfQjg_EzN5v1g4oOOKdwVSuKB4BZQ4wABG9rdzPV75DAixdoumHNwRVLGBSA1-a3ELRmlbVwd1SoIu7cVD3JBXE8ck5Q) for information about creating and using key pairs with an EC2 instance.The key pair needs to be created using the [region](https://developers.facebook.com/docs/whatsapp/aws/#regions) for which you are deploying the WhatsApp Business API.Subscribe to a CentOS 7 ImageThe WhatsApp Business API client makes use of a CentOS 7 image (available in the AWS Marketplace). Terms and conditions should be reviewed and accepted before using the template. Failure to accept the terms will lead to the template creation failure.To review and accept the CentOS 7 AMI image:Go to the [AWS Marketplace: CentOS 7 (x86_64) - with Updates HVM page](https://l.facebook.com/l.php?u=https%3A%2F%2Faws.amazon.com%2Fmarketplace%2Fpp%3Fsku%3Daw0evgkw8e5c1q413zgy5pjce%26fbclid%3DIwAR10d_D3b47Ufgr4Gr-0zhU0N7HVD1tKp1mSrdo9n6YXgHlIqc0ZE7nzjtE&h=AT2zYGNI-IMo1XS7DHde7QpVUKsBClleJ_aY__CEPH2neSXL94J9f6pbxOvz5HyMBq9NLjpupVXMtSvvsSYlyJFvZcpJZmc6Cy8gImYDre1069zl0E7OLmsPNZGei72pJeTtyZjh-U_jHuWjXJFmSQ).Click **Continue to Subscribe** in the upper right corner, then click the **Accept Terms** button.![img](https://scontent.fcpq6-1.fna.fbcdn.net/v/t39.2365-6/34435259_537629343300984_152141137627316224_n.png?_nc_cat=101&ccb=1-5&_nc_sid=ad8a9d&_nc_eui2=AeF-KQYoflWXLbqIbGbBucSkNETk5Rh8pzk0ROTlGHynOQzu-kpVKPO1Fnr1im39PoYr_ARDoAXuM3O3r0EEZm3-&_nc_ohc=Eam8cuFldVIAX9UCzfo&_nc_ht=scontent.fcpq6-1.fna&oh=fc634e70d187499894e84304e2517b51&oe=619ABFBE)Accepting the CentOS termsSupported RegionsThe WhatsApp Business API templates use the EFS resource type, which is not available in all AWS regions. Hence, only the following regions are currently supported:Sydney (ap-southeast-2)Ireland (eu-west-1)Frankfurt (eu-central-1)N. Virginia (us-east-1)Ohio (us-east-2)Oregon (us-west-2)N. California (us-west-1)Seoul (ap-northeast-2)Singapore (ap-southeast-1)Tokyo (ap-northeast-1)Depending on initial testing, WhatsApp will determine whether we can provide an alternate option that is available in all regions.FAQ[Is there a guide on how to deploy WhatsApp Business API on the KOPS Kubernetes cluster on AWS?](https://developers.facebook.com/docs/whatsapp/aws/#faq_1283068475426043)DeploymentStep 1: [*Optional*] Network SetupThe Virtual Private Cloud (VPC) network is generally created when you sign up for an AWS account. Further, there could be several customizations and access control restrictions required that are specific to an enterprise business.If the VPC network infrastructure is already created, you can skip this step. Otherwise, the following template can be used to create the network infrastructure on AWS.The network template is provided for reference purposes only. You can modify it to your specific needs.Network RequirementsThere must be at least two subnets in different availability zones within the region. Otherwise, template creation will fail while creating the RDS (database) resource.It should allow inbound access to HTTP (port: 80), HTTPS (port: 443) and SSH (port: 22). **For security reasons, it is highly recommended you use HTTPS and avoid HTTP**.To deploy the network template:Go to the CloudFormation console for your region (for example, [eu-west-1](https://l.facebook.com/l.php?u=https%3A%2F%2Feu-west-1.console.aws.amazon.com%2Fcloudformation%2Fhome&h=AT2ULzy3injt7MEI6xZjJEOWOqC_9gMVWTXnWxIjnfqs7g0DAiPFrSJXB9Yp9yXJvys442N2NjY1W94eAqtzQMSUXIQ1uYskvudKzwFqnju17XVHfaCsHI-SiIg0GuNXBdUy6SRVEv457ECdezV3YA)).Select **Create a stack**.Choose **Amazon S3 URL** as the Template Source.![img](https://scontent.fcpq6-1.fna.fbcdn.net/v/t39.2365-6/120006348_451857659124910_3727414240552909573_n.png?_nc_cat=103&ccb=1-5&_nc_sid=ad8a9d&_nc_eui2=AeFvrto24QRuJKpCgqdlWNrdOSbCBW-BCmk5JsIFb4EKaRs0bompSxYX03MpmwufQeoFYt4N-gjoRfKHcYfJVfxp&_nc_ohc=JSR3qTeE3WIAX9Wg-ka&_nc_ht=scontent.fcpq6-1.fna&oh=abc66fdc6f70a560c5f7e0d72dfb1e64&oe=619BBB90)Create StackEnter `https://wa-biz-cfn.s3.amazonaws.com/wa_ent_net.yml` and click **Next**, or click

[Deploy Template](https://l.facebook.com/l.php?u=https%3A%2F%2Fconsole.aws.amazon.com%2Fcloudformation%2Fhome%3Ffbclid%3DIwAR0CQeOEcxEmBrqAus0JIfoedBhgwJtrREL4fqbXAbmfyHr_62KO8AN1lho%23%2Fstacks%2Fnew%3FstackName%3DwaNet%26templateURL%3Dhttps%3A%2F%2Fwa-biz-cfn.s3.amazonaws.com%2Fwa_ent_net.yml&h=AT0hFksCbQ9Rz9GIg7qnnCZ1uCzZfsyAeCnx7IjtqwfCvnIS4efVRKWc2RsH5YY9i0rQZxLymc6A3Vdo9jz4P7xmOlIEK9U6t-B0uBhwrhhYCTEYOiJr9MJA3Y466ECOXgDVCzu9AsdGAMQlZo12Jg)

and choose the appropriate [region](https://developers.facebook.com/docs/whatsapp/aws/#regions), if needed, from upper right corner of the webpage.On the **Specify stack details** screen, input the parameter values according to the table below:ParametersNameDescription`Stack name`**Required.**Name of the stack to be createdAvailability Zones ConfigurationNameDescription`Availability zones`**Required.**The availability zones (AZs) for creating the VPC
The template requires at least 2 AZs to be selected. For a production environment, it is recommended to select at least 3 AZs.`Number of availability zones`**Required.**The number of availability zones selectedVPC ConfigurationNameDescription`IP address range`**Required.**The IP address range (CIDR) for this VPC`Tenancy`**Required.**The VPC tenancy
**Options:** `default`, `dedicated`Public Subnet ConfigurationNameDescription`IP range - subnet #1`**Required.**The IP address range (CIDR) for public subnets`IP range - subnet #2`**Required.**The IP address range (CIDR) for public subnets`IP range - subnet #3`**Optional.**Required if the number of availability zones is greater than 2.`IP range - subnet #4`**Optional.**Required if the number of availability zones is greater than 3.Private Subnet ConfigurationNameDescription`Create private subnets?`**Required.****Options:** `true` (default), `false`
If a private subnet is not required for some reason, this flag can be set to `false`.`IP range - subnet #1`**Conditional.**Required if the private subnet creation is set to `true`.`IP range - subnet #2`**Conditional.**Required if the private subnet creation is set to `true`.`IP range - subnet #3`**Conditional.**Required if the private subnet creation is set to `true` and the number of AZs is greater than 2.`IP range - subnet #4`**Conditional.**Required if the private subnet creation is set to `true` and the number of AZs is greater than 3.Step 2: [*Optional*] Database (RDS - MySQL) SetupMySQL release 5.7xx is required.The database password should not contain any of these characters: **?{}&~!()^/"@**Failing to comply with this will likely cause the setup to fail.The WhatsApp Business API client uses the database (RDS - MySQL) to store information required for the functioning of the client.Currently, the WhatsApp Business API client works only with a MySQL database backend.It's highly recommended you create the database automatically with the WhatsApp Business API template below. However, if you already have a database set up, database creation can be skipped by providing the already existing database's hostname.Step 3: WhatsApp Business API DeploymentWhatsApp Enterprise is the main template and creates all the resources (except the network) required for the WhatsApp Business API client. As noted earlier, this template also creates a database resource, if required.To deploy the WhatsApp Business API client:Go to the CloudFormation console for your region (for example, [eu-west-1](https://l.facebook.com/l.php?u=https%3A%2F%2Feu-west-1.console.aws.amazon.com%2Fcloudformation%2Fhome&h=AT2Rs7HawJ-i0cnPsWSaJXFxM0uq1mjDmcwo0Tyde4uIwj2HOfz1gJB3H31yumlj9btfpzGT1BxWvIhXS8ne23muPGWsq3hraOOd--wp_sBwC57GR0y7Nv-6ijXFoAL5FN0BmEEkb6_aTRENGhISgQ)).Select **Create a stack**.Choose **Amazon S3 URL** as the Template Source.![img](https://scontent.fcpq6-1.fna.fbcdn.net/v/t39.2365-6/120006348_451857659124910_3727414240552909573_n.png?_nc_cat=103&ccb=1-5&_nc_sid=ad8a9d&_nc_eui2=AeFvrto24QRuJKpCgqdlWNrdOSbCBW-BCmk5JsIFb4EKaRs0bompSxYX03MpmwufQeoFYt4N-gjoRfKHcYfJVfxp&_nc_ohc=JSR3qTeE3WIAX9Wg-ka&_nc_ht=scontent.fcpq6-1.fna&oh=abc66fdc6f70a560c5f7e0d72dfb1e64&oe=619BBB90)Create StackEnter `https://wa-biz-cfn.s3.amazonaws.com/wa_ent.yml` and click **Next**, or click

[![img](https://scontent.fcpq6-1.fna.fbcdn.net/v/t39.2365-6/19183762_243571296128379_2866348451933716480_n.png?_nc_cat=106&ccb=1-5&_nc_sid=ad8a9d&_nc_eui2=AeGSbzV2NbGYxwERkuuk5BAbdR8ePcgXDJl1Hx49yBcMmU1Nvxtr6EEEnctlmZ1CnD4qF0ERLjUBa5_DYRqiE1rR&_nc_ohc=jDTGPc03LsgAX-AQoKL&_nc_ht=scontent.fcpq6-1.fna&oh=0cefb3728e08b8939c8ddafd01ff16d8&oe=619B1BC5)](https://l.facebook.com/l.php?u=https%3A%2F%2Fconsole.aws.amazon.com%2Fcloudformation%2Fhome%23%2Fstacks%2Fnew%3FstackName%3DwaEnt%26templateURL%3Dhttps%3A%2F%2Fwa-biz-cfn.s3.amazonaws.com%2Fwa_ent.yml&h=AT0LmYAoosO3wbNcg-P3CUnBjx-XbdhzTVFYju1dLf0-TQeZ2dTmKMQbQ79HaBeOBHbEDw8Wm0rgldUK8FmQjvpWxQ4RTMMfTqbwrHBIR1j2wKuvC_e7y64yHxZFm_jF1ORqqJ1sCVSfzYEu6t0v9A)

and choose an appropriate [region](https://developers.facebook.com/docs/whatsapp/aws/#regions), if needed, from the upper right corner of the webpage.
**Note:** The deployment takes about 20-30 minutes.You will then be able to enter parameters. Refer to the table below for parameter descriptions.![img](https://scontent.fcpq6-1.fna.fbcdn.net/v/t39.2365-6/119777529_3235792159803705_8244671237802932272_n.png?_nc_cat=103&ccb=1-5&_nc_sid=ad8a9d&_nc_eui2=AeEit2-je8ASy2BIELA8pSOfMFiQSh4J_TwwWJBKHgn9POHuwQJSP0vHgiGm1eq59XkWIDNMB8a1698Dj7vI34Ld&_nc_ohc=_kh5HzeWcM8AX8yqfI3&_nc_ht=scontent.fcpq6-1.fna&oh=50d0859bb0c5c8ad6207f194c0539374&oe=619BC264)Enter ParametersParametersNameDescription`Stack name`**Required.**Name of the stack to be created.
For an internet-facing load balancer scheme, the stack name must be less than or equal to 22 characters. For an internal load balancer scheme, the stack name must be less than or equal to 12 characters.
**Note:** For deployments in the ap-southeast-1, ap-southeast-2, ap-northeast-1, or ap-northeast-2 regions, the stack name must use 8 characters or less.If the `stack name` is longer then these requirements, the creation of the stack will hang and fail, as it will not be able to create the SSL certificate.General ConfigurationNameDescription`Environment type`**Required.**Used to determine the minimum number of EC2 instances allocated in ECS autoscaling`High Availability`**Optional.**Enables the `static` High Availability feature **Default:** `disabled`
Available as Beta.`Desired number of active 'coreapp' instances`**Optional.**The number of desired active Coreapp instances, used to allocate resources (e.g.: EC2 instances) when creating the stack
**Default:** `2`
*This is only applicable for High Availability/Multiconnect mode.*
After the stack is created, you need to use the [`shards` API call](https://developers.facebook.com/docs/whatsapp/multiconnect_mc#setup) to increase the number of active Coreapp instances.Network ConfigurationNameDescription`VPC`**Required.**The VPC for this deployment.
WhatsApp also provides a sample/reference template to create a VPC with public and private subnets. The sample template can be found at [https://wa-biz-cfn.s3.amazonaws.com/wa_ent_net.yml](https://l.facebook.com/l.php?u=https%3A%2F%2Fwa-biz-cfn.s3.amazonaws.com%2Fwa_ent_net.yml%3Ffbclid%3DIwAR2a9yVqF0zxYBte5Ta4g3HSSG2WTnosLhXVDY43nlOJ4Q6unSHypQX3Mec&h=AT3pGQcgf4cDddOVTsjD6Axvf4uO6POLViGzGgwsoiLmvvn2SggcLwPEsQi7BD2vGXfWM8U6CbN_DssW7fpC8nS2Mo24J_S98BY6it1OQx0ss3tN4c6hNz61HroiLP5W2-jctqxe5OP0-SXUXJIciA).`Subnets`**Required.**The subnets for this deployment.
Select at least 2 subnets in *different availability zones*. For a production environment, 3 *private* subnets are recommended.
Either private or public subnets need to be selected. Private and public subnets should not be mixed.`Number of subnets`**Required.**The number of subnets chosen.`Load balancer scheme`**Required.****Internet-facing** — The load balancer is visible to public. Select this if you want the WhatsApp Business API service to be visible on a public endpoint.**Internal** - The load balancer will not be reachable from outside of AWS. This scheme is preferred if you have your backend/CRM systems also hosted within AWS.**Note:** If an **internal** scheme is chosen for the load balancer, configure private subnets for the load balancer. However, if an **internet-facing** scheme is chosen, configure public subnets for the load balancer. Failure to configure this properly results in the load balancer being inaccessible.`Load balancer subnets`**Required.**For an **internet-facing** load balancer, select the public subnets from the VPC.
For an **internal** load balancer, select the appropriate private subnets.
Similar to other subnets, it's recommended you choose 3 subnets in *different availability zones* for the *production* environment.Container ConfigurationNameDescription`EC2 instance type`**Required.**It's recommended choosing non-T2 instance types for production work loads.`Keypair to use`**Required.**The appropriate key pair to access the EC2 instance, if required.`WA Enterprise container registry`**Optional.**This is for future-proofing and to support experimental WhatsApp Business API clients. The default value should be good for a majority of cases.`WA Enterprise Client version`**Required.**It's always recommended to use the *latest stable* version (see the [changelog](https://developers.facebook.com/docs/whatsapp/changelog) for the latest version).
**Format:** `v2.yy.xx`The WhatsApp Business API client version always begins with a "v", unless explicitly stated otherwise. Using an incorrect version will cause stack creation failure.`EBS volume size`**Required.**It's recommended choosing 16GB or more for production work loads.Database ConfigurationNameDescription`Store configuration in DB`**Optional.**Enables storing configuration information in the database.
**Options:** `true` (default), `false`
Setting the value to `false` disables storing the configuration information in the database and stores it in files instead.`Existing DB hostname`**Optional.**The existing database hostname
If you already have a dedicated MySQL database instance for the WhatsApp Business API client, you can enter the hostname here.
**Leaving it empty will create a new RDS MySQL instance.**`Storage capacity`**Conditional.**Required if a database instance must be created by this template.
Enter the storage capacity required for the RDS in GB.`Instance type`**Conditional.**Required if a database instance must be created by this template.
It's recommended choosing non-T2 instance types for production loads.`Administrator name`**Required.**The administrator name for accessing the database.`Administrator password`**Required.**The administrator password for accessing the database.The database password should not contain any of these characters: **?{}&~!()^/"@**`Server port`**Required.**Port number to access the database backend.`DB Idle Connection Timeout`**Optional.**The length of time in milliseconds after which the RDS closes idle connections
**Default:** 180000 ms`Storage type`**Conditional.**Required if a database instance must be created by this template. For production loads, it's recommended to choose the **General Purpose SSD (gp2)** or **Provisioned IOPS (io1)** storage type.`Multi-AZ`**Conditional.**Required if a database instance must be created by this template.
Enabling the `Multi-AZ` parameter turns on High Availability and failover support for the database instance.`IOPS`**Conditional.**Required if a database instance must be created by this template.
This is only applicable if you also select the **Provisioned IOPS (io1)** storage type.`Engine version`**Conditional.**Required if a database instance must be created by this template.Logging ConfigurationNameDescription`Logging driver for container logs`**Optional.**Logging driver for the container logs.
**Options:** `json-file` (default), `awslogs`
The `json-file` value stores the logs on EC2 hosts. The `awslogs` value streams all container logs to CloudWatch.`Maximum container log file size`**Optional.**The maximum size of a container log file in MB before it's rotated.`Maximum number of container log files`**Optional.**The maximum number of log files to retain per container.
Stopped containers are eventually removed from the host. In those cases, all the retained log files for that container are deleted.`Days to retain CloudWatch logs`**Optional.**Number of days to retain logs in CloudWatch.
Earlier this value was hard-coded in the template, but it is now made configurable. Select from one of the available values in the list.Filesystem ConfigurationNameDescription`File system identifier`**Not used.**Leave this parameter empty.Security ConfigurationNameDescription`Key to encrypt DB & EFS`**Optional.**By default, the AWS service key (the **Default-Key** option) is used to encrypt DB & EFS data at rest. Other options are:**Unencrypted:** The data at rest is not encrypted**Create-New-Key:** A new KMS key is created and used to encrypt the data**User-Provided-Key:** You can provide a KMS key ID that is used to encrypt the data. Leave this blank, if another option is selected.`User provided key id`**Optional.**You can provide a KMS key ID that is used to encrypt the data. Leave this blank, if the **User-Provided-Key** option is *not* selected.`DB connection encryption`**Optional.**By default, the data in transit to the database is encrypted. This is currently only applicable for the Coreapp. Webapp encryption is not yet supported. In addition, with a new database engine, even if this option is disabled, the Coreapp performs encryption, but without server certificate (identity) verification.`CA certificate for DB connection`**Optional.**The default value contains the RDS certificate bundle. If a non-RDS database is used, then the appropriate CA certificate bundle can be provided or you can leave it blank. The default value is adequate for enabling a secure connection with the database.`Client certificate for DB connection`**Optional.**The client certificate for the database connection`Client key for DB connection`**Optional.**The client key for the database connectionOutput after DeploymentUpon successful creation of template, the following parameters are displayed:**Load balancer name**: Hostname of the load balancer accessing the WhatsApp Business API client**Database hostname**: Hostname of the database that is created or provided during template creation**Database port number**: Port number for the database connection**Database administrator name**: Administrator name for the database connectionFor security reasons, the database administrator password is **not** displayed.![img](https://scontent.fcpq6-1.fna.fbcdn.net/v/t39.2365-6/19182967_266574910415966_2664298020505387008_n.png?_nc_cat=108&ccb=1-5&_nc_sid=ad8a9d&_nc_eui2=AeGGXCck7_eYSOZxF9pF-w0nYV9mJUQEAMFhX2YlRAQAwU6o9L6zdLkYGfHBXOZ6CwDKBdiFRewJo0fNc0AZeHxS&_nc_ohc=lh4uFN2mSf4AX_tSCZO&_nc_ht=scontent.fcpq6-1.fna&oh=c5d0e35bbaa34089d72809c491218875&oe=619AD093)Output ParametersWhatsApp Busines API Client ConfigurationOnce the WhatsApp Business API client is successfully deployed, it needs to be configured to bring it into operation.Step 1: Set ShardsAfter the stack is created, you need to use the [`shards` API call](https://developers.facebook.com/docs/whatsapp/multiconnect_mc) to increase the number of active Coreapp instances to match the value selected for `Desired number of active 'coreapp' instances` during stack creation.Step 2: [*Optional*] SSL ConfigurationThe WhatsApp Business API client generates a self-signed certificate by default when it is created. The Certification Authority (CA) certificate used to generate the self-signed certificate might be required to verify the WhatsApp Business API client endpoint and to avoid a certificate trust warning.You can download the CA certificate and store it locally to avoid the certificate trust warning, or upload your own. Refer to the [`certificate` node documentation](https://developers.facebook.com/docs/whatsapp/api/certificates) for more information.In AWS deployments, the SSL certificate is created using the load balancer hostname. If an IP address is used instead of the hostname for access, the warning will still be noticed.WhatsApp will support configuring customer provided SSL certificates in a future release.Step 3: Phone RegistrationRefer to the [Phone Number guide](https://developers.facebook.com/docs/whatsapp/guides/phone-number) for more in-depth information about phone number registration.Download the base64-encoded certificate from your WhatsApp account in the [Facebook Business Manager](https://business.facebook.com/) under the *Phone Numbers* tab of the WhatsApp Manager.Once you have the correct phone number selected and have the base64-encoded certificate, you need to register the WhatsApp Business API client via the `account` node. Refer to the [Registration documentation](https://developers.facebook.com/docs/whatsapp/api/account) for more information.If the phone number is capable of receiving text messages, use the SMS method for registration code retrieval.If you have already received the registration code from WhatsApp, you can skip this step.Step 4: Webhook ConfigurationThe configuration of WhatsApp Business API web callbacks and other parameters is described in the [Application Settings documentation](https://developers.facebook.com/docs/whatsapp/api/settings/app).Refer to the [Webhooks documentation](https://developers.facebook.com/docs/whatsapp/api/webhooks) for more information.Step 5: Validation of the SetupOnce the configuration and registration steps are successful, a message can be sent and received to validate the basic functionality of WhatsApp Business API client. This is fully described in the [Messages documentation](https://developers.facebook.com/docs/whatsapp/api/messages).Upon successful receipt of a message, the WhatsApp Business API client will `POST` the message status/details to the Webhook configured in **Step 4**.If your message was successfully received, congratulations, you are all set! Please refer to the [Reference documentation](https://developers.facebook.com/docs/whatsapp/api/reference) for more information on the available API endpoints.Restarting the Coreapp and WebappTo restart the WhatsApp Business API client, in the the ECS console (for example, [https://us-west-2.console.aws.amazon.com/ecs/home?region=us-west-2#/clusters](https://l.facebook.com/l.php?u=https%3A%2F%2Fus-west-2.console.aws.amazon.com%2Fecs%2Fhome%3Fregion%3Dus-west-2%26fbclid%3DIwAR0ZcpcYG57o0-GyaNMBBF5uwqDqtybdInlQyQyyhBAX1CM7MQp_qfPDkJo%23%2Fclusters&h=AT3HZ0wcrtjAaKdQf9tgfwj-q1uQQjbE2x3yatEbPEuXzc7fprQaoSk1m1QA9El9SPB6tIi08gXvsuqmf1WW826cTeG6ar8ANBCMcfL3o8ACebTHA5mxvqGo9fzjrI_N3uPdPpxh34r4uYh4W80ZKg)):Select the correct region in the upper right corner.Select the appropriate cluster from the list.Under the **Services** tab, select the service name that contains **WAEntService**.Select the **Tasks** tab. There should typically be only one task, with an ID made of hex digits.In the **Tasks** window, click **Stop** in the upper right corner, then click **Stop** again when prompted.This stops both the Webapp and CoreApp. Shortly after, the AWS infrastructure restarts both the Webapp and CoreApp.You can expect about a minute or two of downtime.Upgrading the WhatsApp Business API ClientIt is highly recommended you backup your current application settings before uninstallation. Please follow the [Backup and Restore documentation](https://developers.facebook.com/docs/whatsapp/api/settings/backup-and-restore).**Note:** You can upgrade the CFN template URL and the WhatsApp Business API client version at the same time. In **Step 5** below, instead of selecting **Use current template**, select the **Replace current template** option. In the **Specify template** section, leave the **Amazon S3 URL** option selected and enter the appropriate WhatsApp Business API CFN template URL (e.g., for the WhatsApp Business API client: `https://s3.amazonaws.com/wa-biz-cfn/wa_ent.yml`).Go to the CloudFormation (CFN) console (for example, [https://us-west-2.console.aws.amazon.com/cloudformation/home?region=us-west-2#/stacks?filter=active](https://us-west-2.console.aws.amazon.com/cloudformation/home?region=us-west-2&fbclid=IwAR1SoUtzQggIP7tSmjEj3j1PXQEkfEqtVfQPiGzG9T9QemBsj8VYSQnBMko#/stacks?filter=active)).Select the correct region in the upper right corner.Select the WhatsApp Business API client stack that was already created.Click **Update**.On the **Prerequisite - Prepare template** page, leave the **Use current template** option selected, and click **Next**.On the **Specify stack details** page, change the **WhatsApp Business API Client (container) version** to the desired version. *DO NOT CHANGE any other parameter.* Click **Next**.On the **Configure stack options** page, click **Next**.On the **Review** page, select "I acknowledge that AWS CloudFormation might create IAM resources with custom names." Review the **Change set preview** section for any unexpected changes. If there are any unexpected changes or you are unsure, please contact [WhatsApp Direct Support](https://developers.facebook.com/docs/whatsapp/contact-support). Click **Update stack**.The Stack Update status can be tracked in the CFN console and will change from **UPDATE_IN_PROGRESS** to **UPDATE_COMPLETE** once the upgrade is finished.**Quick upgrade verification:** [Send a text message](https://developers.facebook.com/docs/whatsapp/api/messages/text) and verify that the API response contains the correct version number (i.e., the new version). Verify also that the message is received by the recipient.WhatsApp CFN template updateGo to the CloudFormation (CFN) console (for example, [https://us-west-2.console.aws.amazon.com/cloudformation/home?region=us-west-2#/stacks?filter=active](https://l.facebook.com/l.php?u=https%3A%2F%2Fus-west-2.console.aws.amazon.com%2Fcloudformation%2Fhome%3Fregion%3Dus-west-2%26fbclid%3DIwAR2zb8sslAwgiftCRzstZRyVC0wSS9gAjWUmYYK51zJds7hn1wgPEntHq94%23%2Fstacks%3Ffilter%3Dactive&h=AT2U169KlzUKo7pQ90qta0TangIO7qSMQFK8bZQQo6eycN-V2gbDbEJvySaUC2tTNTzoP_QtZTNEWDBcxxCDjiJoIPOTRmUGf1LqJCL_XtRiar5FPdSUQ9AmvSIQ2A0U6RjAWRH8XC1awEN-R0UMvg)).Select the correct region in the upper right corner.Select the WhatsApp Business API client stack that was already created.Click **Update**.On the **Prerequisite - Prepare template** page, select the **Replace current template** option. In the **Specify template** section, leave the **Amazon S3 URL** option selected and enter the appropriate WhatsApp Business API CFN template URL (e.g., for the WhatsApp Business client: `https://wa-biz-cfn.s3.amazonaws.com/wa_ent.yml`). Click **Next**.On the **Specify Stack Details** page, enter the appropriate parameters, per the information in previous sections. Click **Next**.On the **Configure Stack Options** page, click **Next**.On the **Review** page, select "I acknowledge that AWS CloudFormation might create IAM resources with custom names." Review the **Change set preview** section for any unexpected changes. If there are any unexpected changes or you are unsure, please contact [WhatsApp Direct Support](https://developers.facebook.com/docs/whatsapp/contact-support). Click **Update stack**.The Stack Update status can be tracked in the CFN console and will change from **UPDATE_IN_PROGRESS** to **UPDATE_COMPLETE** once the upgrade is finished.Rotating the RDS CertificateIf you enabled database connection encryption on the stack creation page, the connection between your Coreapp and the RDS instance is encrypted through a certificate that defaults to the certificate published by AWS RDS.**The previous 2015 AWS RDS certificate will expire on March 5, 2020.** Follow the steps here to rotate the RDS Certificate for your WhatsApp Business API client.Before you start, it is highly recommended to backup your current application settings and take a snapshot for your RDS instance. See the [Backup and Restore documentation](https://developers.facebook.com/docs/whatsapp/api/settings/backup-and-restore) for more information.Ensure your EC2 instances are based on the latest AMIs listed below. If they are not, it’s likely your stack is created using the old CFN template that uses an old custom AMI. Upgrade your CFN template by following the instructions in the [WhatsApp CFN template update section](https://developers.facebook.com/docs/whatsapp/aws/#updatecfn) above.ap-northeast-1: # Tokyo
AMIID: ami-045f38c93733dd48dap-northeast-2: # Seoul
AMIID: ami-06cf2a72dadf92410ap-southeast-1: # Singapore
AMIID: ami-0b4dd9d65556cac22ap-southeast-2: # Sydney
AMIID: ami-08bd00d7713a39e7deu-central-1: # Frankfurt
AMIID: ami-04cf43aca3e6f3de3eu-west-1: # Ireland
AMIID: ami-0ff760d16d9497662us-east-1: # N. Virginia
AMIID: ami-02eac2c0129f6376bus-east-2: # Ohio
AMIID: ami-0f2b4fc905b0bd1f1us-west-1: # N. California
AMIID: ami-074e2d6769f445be5us-west-2: # Oregon
AMIID: ami-01ed306a12b7d1c96Ensure your EC2 instances have the latest RDS certificate bundle that includes both the old 2015 certificate and the new 2019 certificate.SSH into your EC2 instances. The certificates are located in `/opt/certs/db-ca.pem`.If needed, replace the existing certificates with the latest certificate bundle. The latest bundle can be downloaded with:`sudo wget https://s3.amazonaws.com/rds-downloads/rds-combined-ca-bundle.pem`Note that if you can’t SSH into your EC2 instance, you can force the certificate update through EC2 instance replacement, which could cause some downtime. This assumes that when you created the stack, you were using the default `rds-combined-ca-bundle.pem` as the database connection CA certificate (This can be confirmed by checking the `DBConnCA` parameter in your stack through the AWS console). You’ll need to stop your current EC2 instance manually, then a new EC2 instance is deployed automatically in about 20 minutes. In this case, you can skip step 3.Restart all your WhatsApp Business API client containers. This can be done through the AWS console ECS service by stopping all tasks in your desired cluster. All tasks should be back in running state in less than 5 minutes. After that your WhatsApp Business API client should be using the latest certificate bundle and able to connect with both RDS instances in the old and new certificates.Update the RDS certificate on your RDS instances to the new 2019 certificate. See [Updating Your CA Certificate by Applying DB Instance Maintenance](https://docs.aws.amazon.com/AmazonRDS/latest/UserGuide/UsingWithRDS.SSL-certificate-rotation.html#UsingWithRDS.SSL-certificate-rotation-maintenance) in the AWS documentation for more information.



[On-Premises API](https://developers.facebook.com/docs/whatsapp/on-premises)

- Get Started
  - [Client Architecture](https://developers.facebook.com/docs/whatsapp/on-premises/get-started/client-architecture)
  - [Security](https://developers.facebook.com/docs/whatsapp/on-premises/get-started/security)
  - Installation
    - [Dev Single Instance](https://developers.facebook.com/docs/whatsapp/installation/dev-single-instance)
    - [Dev Multiconnect](https://developers.facebook.com/docs/whatsapp/installation/dev-multiconnect)
    - [Dev Multiconnect on Minikube](https://developers.facebook.com/docs/whatsapp/installation/dev-multiconnect-minikube)
    - [Prod Single Instance](https://developers.facebook.com/docs/whatsapp/installation/prod-single-instance)
    - [Prod Multiconnect](https://developers.facebook.com/docs/whatsapp/installation/prod-multiconnect)
    - [AWS](https://developers.facebook.com/docs/whatsapp/aws)
  - [Migration](https://developers.facebook.com/docs/whatsapp/on-premises/get-started/migration)
  - [Advanced Setup](https://developers.facebook.com/docs/whatsapp/on-premises/get-started/advanced-setup)
  - [Postman Collection](https://developers.facebook.com/docs/whatsapp/on-premises/get-started/postman)
- [Guides](https://developers.facebook.com/docs/whatsapp/guides)
- [Reference](https://developers.facebook.com/docs/whatsapp/api/reference)
- [Webhooks](https://developers.facebook.com/docs/whatsapp/api/webhooks)
- [Changelog](https://developers.facebook.com/docs/whatsapp/changelog)
- [FAQs](https://developers.facebook.com/docs/whatsapp/faq)

